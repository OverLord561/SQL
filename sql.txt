--IF OBJECT_ID('Employee', 'U') IS NOT NULL
--DROP TABLE Employee;

--IF OBJECT_ID('Firm', 'U') IS NOT NULL
--DROP TABLE Firm;

--IF OBJECT_ID('ContactInfo', 'U') IS NOT NULL
--DROP TABLE ContactInfo;

--IF OBJECT_ID('EmployeeTelephone', 'U') IS NOT NULL
--DROP TABLE EmployeeTelephone;



--TABLE Firm
IF OBJECT_ID('Firm', 'U') IS NULL
create table Firm
(
  FirmId integer  NOT NULL primary key,
  FirmName   nVARCHAR(15),
  FirmAdress  nVARCHAR(15)  
  );

-- TABLE Employee
IF OBJECT_ID('Employee', 'U') IS NULL
create table Employee
(
  EmployeeId    integer NOT NULL primary key,
  Name   nVARCHAR(15),
  Surname nVARCHAR(15),
  FirmId integer REFERENCES Firm
);


-- TABLE ContactInfo
IF OBJECT_ID('ContactInfo', 'U') IS NULL
create table ContactInfo
(
  EmployeeId integer NOT NULL primary key REFERENCES Employee ,
  Birthday date,
  Adress nVARCHAR(15) 
  
);
  
-- TABLE EmployeeTelephone
IF OBJECT_ID('EmployeeTelephone', 'U') IS NULL
create table EmployeeTelephone
(
  EmployeeTelephoneId   integer  NOT NULL primary key,
  EmployeeId integer REFERENCES Employee,
  Telephone nVARCHAR(15), 
  SimCard nVARCHAR(15)
);

-- Add to Firm
insert into Firm (FirmId, FirmName, FirmAdress) 
 values (1, 'Lesha DKZ', 'Dzer 6');
insert into Firm (FirmId, FirmName, FirmAdress) 
 values (2, 'WebSoft', 'Dzer 8');
 
 --Add to Employee
insert into Employee (EmployeeId, Name, Surname, FirmId) 
 values (1, 'Roman', 'Kisera', 1);
 insert into Employee (EmployeeId, Name, Surname, FirmId) 
 values (2, 'Barladyn', 'Taras', 1);
 insert into Employee (EmployeeId, Name, Surname, FirmId) 
 values (3, 'Rudoy', 'Vetal', 2);

 
  --Add to ContactInfo
insert into ContactInfo (EmployeeId, Birthday, Adress) 
 values (1, '12.28.1994', 'Dzer 6');
insert into ContactInfo (EmployeeId, Birthday, Adress) 
 values (2, '04.15.1994', 'Dzer 6');
insert into ContactInfo (EmployeeId, Birthday, Adress) 
 values (3, '10.16.1994', 'Dzer 6');

 
 --Add to EmployeeTelephone
 
insert into EmployeeTelephone (EmployeeTelephoneId, EmployeeId, Telephone, SimCard) 
 values (1, 3, '095-468-3763', 'MTC');
insert into EmployeeTelephone (EmployeeTelephoneId, EmployeeId, Telephone, SimCard) 
 values (2, 3, '097-156-2437', 'MTC');
insert into EmployeeTelephone (EmployeeTelephoneId, EmployeeId, Telephone, SimCard) 
 values (3, 1, '063-339-3612', 'LIFE');

update EmployeeTelephone set SimCard = 'Kyivstar' where EmployeeTelephoneId = '2';


commit;

--Request
select e.Name , e.Surname, c.Birthday, c.Adress, f.FirmName, f.FirmAdress, tel.Telephone, tel.SimCard  from employee e, contactinfo c, firm f, employeetelephone tel where  e.FirmId =f.FirmId and e.EmployeeId = c.EmployeeId and e.EmployeeId = tel.EmployeeId;


--Add Storage Procedure
create procedure EmployeeInsert  (
@EmployeeId int,
@Name nVARCHAR(15),
@Surname nVARCHAR(15),
@FirmId int
                                 )

AS

begin
  INSERT INTO Employee VALUES (
  @EmployeeId,
  @Name,
  @Surname,
  @FirmId
                               );
    
end 


--Execute storage procedure
Execute [DB_optimization].[dbo].[EmployeeInsert] "6","Petrov","Roman", "2";

delete Employee  where Employee.EmployeeId =6;

Execute EmployeeInsert "6","Petrov","Roman", "2";
